{"ast":null,"code":"import firebase from \"firebase\";\nimport { showUserPets } from \".\";\nimport { USER_STATE_CHANGE } from \"../constants\";\n\nrequire(\"firebase/firebase-auth\");\n\nexport var userAuthStateListener = function userAuthStateListener() {\n  return function (dispatch) {\n    firebase.auth().onAuthStateChanged(function (user) {\n      if (user) {\n        var _firebase$auth$curren;\n\n        dispatch(getCurrentUserData());\n        dispatch(showUserPets((_firebase$auth$curren = firebase.auth().currentUser) == null ? void 0 : _firebase$auth$curren.uid));\n      } else {\n        dispatch({\n          type: USER_STATE_CHANGE,\n          currentUser: null,\n          loaded: true\n        });\n      }\n    });\n  };\n};\nexport var getCurrentUserData = function getCurrentUserData() {\n  return function (dispatch) {\n    var _firebase$auth$curren2;\n\n    firebase.firestore().collection(\"user\").doc((_firebase$auth$curren2 = firebase.auth().currentUser) == null ? void 0 : _firebase$auth$curren2.uid).onSnapshot(function (res) {\n      if (res.exists) {\n        return dispatch({\n          type: USER_STATE_CHANGE,\n          currentUser: res.data(),\n          loaded: true\n        });\n      }\n    });\n  };\n};\nexport var login = function login(email, password) {\n  return function (dispatch) {\n    return new Promise(function (resolve, reject) {\n      firebase.auth().signInWithEmailAndPassword(email, password).then(function () {\n        resolve();\n      }).catch(function () {\n        reject();\n      });\n    });\n  };\n};\nexport var logout = function logout() {\n  return function (dispatch) {\n    return new Promise(function (resolve, reject) {\n      firebase.auth().signOut().then(function () {\n        return resolve();\n      });\n    }).catch(function () {\n      reject();\n    });\n  };\n};\nexport var register = function register(email, password) {\n  return function (dispatch) {\n    return new Promise(function (resolve, reject) {\n      firebase.auth().createUserWithEmailAndPassword(email, password).then(function () {\n        resolve();\n      }).catch(function (e) {\n        console.log(e);\n        reject();\n      });\n    });\n  };\n};","map":{"version":3,"names":["firebase","showUserPets","USER_STATE_CHANGE","require","userAuthStateListener","dispatch","auth","onAuthStateChanged","user","getCurrentUserData","currentUser","uid","type","loaded","firestore","collection","doc","onSnapshot","res","exists","data","login","email","password","Promise","resolve","reject","signInWithEmailAndPassword","then","catch","logout","signOut","register","createUserWithEmailAndPassword","e","console","log"],"sources":["D:/2022-1/GEST.PROYECTOS/pocket-pet/frontend/src/redux/actions/auth.js"],"sourcesContent":["import firebase from \"firebase\";\r\nimport { showUserPets } from \".\";\r\nimport { USER_STATE_CHANGE } from \"../constants\";\r\nrequire(\"firebase/firebase-auth\");\r\n\r\nexport const userAuthStateListener = () => (dispatch) => {\r\n  firebase.auth().onAuthStateChanged((user) => {\r\n    //comprobar si esta logeado\r\n    if (user) {\r\n      dispatch(getCurrentUserData());\r\n      dispatch(showUserPets(firebase.auth().currentUser?.uid));\r\n    } else {\r\n      dispatch({ type: USER_STATE_CHANGE, currentUser: null, loaded: true });\r\n    }\r\n  });\r\n};\r\n\r\nexport const getCurrentUserData = () => (dispatch) => {\r\n  firebase\r\n    .firestore()\r\n    .collection(\"user\")\r\n    .doc(firebase.auth().currentUser?.uid)\r\n    .onSnapshot((res) => {\r\n      if (res.exists) {\r\n        return dispatch({\r\n          type: USER_STATE_CHANGE,\r\n          currentUser: res.data(),\r\n          loaded: true,\r\n        });\r\n      }\r\n    });\r\n};\r\n\r\nexport const login = (email, password) => (dispatch) =>\r\n  new Promise((resolve, reject) => {\r\n    firebase\r\n      .auth()\r\n      .signInWithEmailAndPassword(email, password)\r\n      .then(() => {\r\n        resolve();\r\n      })\r\n      .catch(() => {\r\n        reject();\r\n      });\r\n  });\r\n\r\nexport const logout = () => (dispatch) =>\r\n  new Promise((resolve, reject) => {\r\n    firebase\r\n      .auth()\r\n      .signOut()\r\n      .then(() => resolve());\r\n  }).catch(() => {\r\n    reject();\r\n  });\r\nexport const register = (email, password) => (dispatch) =>\r\n  new Promise((resolve, reject) => {\r\n    firebase\r\n      .auth()\r\n      .createUserWithEmailAndPassword(email, password)\r\n      .then(() => {\r\n        resolve();\r\n      })\r\n      .catch((e) => {\r\n        console.log(e)\r\n        reject();\r\n      });\r\n  });\r\n"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,UAArB;AACA,SAASC,YAAT,QAA6B,GAA7B;AACA,SAASC,iBAAT;;AACAC,OAAO,CAAC,wBAAD,CAAP;;AAEA,OAAO,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB;EAAA,OAAM,UAACC,QAAD,EAAc;IACvDL,QAAQ,CAACM,IAAT,GAAgBC,kBAAhB,CAAmC,UAACC,IAAD,EAAU;MAE3C,IAAIA,IAAJ,EAAU;QAAA;;QACRH,QAAQ,CAACI,kBAAkB,EAAnB,CAAR;QACAJ,QAAQ,CAACJ,YAAY,0BAACD,QAAQ,CAACM,IAAT,GAAgBI,WAAjB,qBAAC,sBAA6BC,GAA9B,CAAb,CAAR;MACD,CAHD,MAGO;QACLN,QAAQ,CAAC;UAAEO,IAAI,EAAEV,iBAAR;UAA2BQ,WAAW,EAAE,IAAxC;UAA8CG,MAAM,EAAE;QAAtD,CAAD,CAAR;MACD;IACF,CARD;EASD,CAVoC;AAAA,CAA9B;AAYP,OAAO,IAAMJ,kBAAkB,GAAG,SAArBA,kBAAqB;EAAA,OAAM,UAACJ,QAAD,EAAc;IAAA;;IACpDL,QAAQ,CACLc,SADH,GAEGC,UAFH,CAEc,MAFd,EAGGC,GAHH,2BAGOhB,QAAQ,CAACM,IAAT,GAAgBI,WAHvB,qBAGO,uBAA6BC,GAHpC,EAIGM,UAJH,CAIc,UAACC,GAAD,EAAS;MACnB,IAAIA,GAAG,CAACC,MAAR,EAAgB;QACd,OAAOd,QAAQ,CAAC;UACdO,IAAI,EAAEV,iBADQ;UAEdQ,WAAW,EAAEQ,GAAG,CAACE,IAAJ,EAFC;UAGdP,MAAM,EAAE;QAHM,CAAD,CAAf;MAKD;IACF,CAZH;EAaD,CAdiC;AAAA,CAA3B;AAgBP,OAAO,IAAMQ,KAAK,GAAG,SAARA,KAAQ,CAACC,KAAD,EAAQC,QAAR;EAAA,OAAqB,UAAClB,QAAD;IAAA,OACxC,IAAImB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;MAC/B1B,QAAQ,CACLM,IADH,GAEGqB,0BAFH,CAE8BL,KAF9B,EAEqCC,QAFrC,EAGGK,IAHH,CAGQ,YAAM;QACVH,OAAO;MACR,CALH,EAMGI,KANH,CAMS,YAAM;QACXH,MAAM;MACP,CARH;IASD,CAVD,CADwC;EAAA,CAArB;AAAA,CAAd;AAaP,OAAO,IAAMI,MAAM,GAAG,SAATA,MAAS;EAAA,OAAM,UAACzB,QAAD;IAAA,OAC1B,IAAImB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;MAC/B1B,QAAQ,CACLM,IADH,GAEGyB,OAFH,GAGGH,IAHH,CAGQ;QAAA,OAAMH,OAAO,EAAb;MAAA,CAHR;IAID,CALD,EAKGI,KALH,CAKS,YAAM;MACbH,MAAM;IACP,CAPD,CAD0B;EAAA,CAAN;AAAA,CAAf;AASP,OAAO,IAAMM,QAAQ,GAAG,SAAXA,QAAW,CAACV,KAAD,EAAQC,QAAR;EAAA,OAAqB,UAAClB,QAAD;IAAA,OAC3C,IAAImB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;MAC/B1B,QAAQ,CACLM,IADH,GAEG2B,8BAFH,CAEkCX,KAFlC,EAEyCC,QAFzC,EAGGK,IAHH,CAGQ,YAAM;QACVH,OAAO;MACR,CALH,EAMGI,KANH,CAMS,UAACK,CAAD,EAAO;QACZC,OAAO,CAACC,GAAR,CAAYF,CAAZ;QACAR,MAAM;MACP,CATH;IAUD,CAXD,CAD2C;EAAA,CAArB;AAAA,CAAjB"},"metadata":{},"sourceType":"module"}